{"version":3,"sources":["report.draft.js"],"names":["$","rows","find","text","spinner","reptype","hulla","hullabaloo","populateDraftTable","page","ajax","url","baseurl","type","dataType","data","beforeSend","html","success","fail","jqXHR","textStatus","errorThrown","console","log","getId","reportType","repotype","val","printReady","map","this","value","get","join","autocomplete","source","request","response","q","term","results","key","label","firstname","lastname","id","custid","minLength","select","event","ui","item","shapecut","color","click","change","show","hide","on","keyup","length","search","e","trigger","btnActions","pagination","preventDefault","reload","prop","saveDraft","formDraft","formData","cstid","x","FormData","serializeArray","each","i","field","append","name","attr","processData","contentType","auth","send","message","error","payment","saveAmount","formPayment","total","modal","document","action","call","link","closest","toggleClass","checked","is"],"mappings":"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","file":"../report.draft.js","sourcesContent":["$(function () {\r\n\r\n  // Variables\r\n  var rows = $('#rowCount').find(\":selected\").text();\r\n  var spinner = '<i class=\"fa fa-spinner fa-pulse fa-lg fa-fw d-block mx-auto text-white\"></i><span class=\"sr-only\">Loading...</span>';\r\n  var reptype = $('#option1, #option2, #option3');\r\n  var hulla = new hullabaloo();\r\n\r\n  // Fetch all reports\r\n  var populateDraftTable = function (page, rows) {\r\n\r\n    $.ajax({\r\n      url: baseurl + 'admin/report/draft/handler/populate-draft/' + page + '/',\r\n      type: 'GET',\r\n      dataType: 'html',\r\n      data: {\r\n        page: page,\r\n        rows: rows\r\n      },\r\n      beforeSend: function () {\r\n        $('#draftTable').html(spinner);\r\n      },\r\n      success: function (data) {\r\n        $('#draftTable').html('');\r\n        $('#draftTable').html(data);\r\n      },\r\n      fail: function (jqXHR, textStatus, errorThrown) {\r\n        console.log(errorThrown);\r\n      }\r\n    });\r\n    \r\n  };\r\n\r\n  // Search Report\r\n\tvar searchDraft = function (key) {\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: baseurl + 'admin/report/draft/handler/populate-draft',\r\n\t\t\ttype: 'GET',\r\n\t\t\tdataType: 'html',\r\n\t\t\tdata: {\r\n\t\t\t\tsearch: true,\r\n        id: key\r\n\t\t\t},\r\n\t\t\tbeforeSend: function () {\r\n\t\t\t\t$('#draftTable').html(spinner);\r\n\t\t\t},\r\n\t\t\tsuccess: function (data) {\r\n\t\t\t\t$('#draftTable').html('');\r\n        $('#draftTable').html(data);\r\n\t\t\t},\r\n\t\t\tfail: function (jqXHR, textStatus, errorThrown) {\r\n\t\t\t\tconsole.log(errorThrown);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n  // Fetch ID Based on user select\r\n  var getId = function (reportType) {\r\n    $.ajax({\r\n      url: baseurl + 'admin/report/handler/id',\r\n      type: 'GET',\r\n      dataType: 'html',\r\n      data: {\r\n        repotype: reportType\r\n      },\r\n      success: function (data) {\r\n        $('#repid').val(data);\r\n      },\r\n      fail: function () {\r\n        console.log('Error');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Function to populate customer on user input\r\n  var populateCustomer = function () {\r\n    $(\"#customer\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/customers/customer/append-customer',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.firstname + ' ' + value.lastname,\r\n              value: value.firstname + ' ' + value.lastname,\r\n              id: value.custid\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 1,\r\n      select: function (event, ui) {\r\n        $('#customerID').val(ui.item.id);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Function to populate shape-cut field on user input\r\n  var populateShapeCut = function () {\r\n    $(\"#shapecutField\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/report/handler/populate-shapecut',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.shapecut,\r\n              value: value.shapecut\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 2\r\n    });\r\n  };\r\n\r\n  // Function to populate color field on user input\r\n  var populateColor = function () {\r\n    $(\"#colorField\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/report/handler/populate-color',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.color,\r\n              value: value.color\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 2\r\n    });\r\n  };\r\n\r\n  \r\n\r\n  // Function to Add a Report to DB\r\n  var addReport = function () {\r\n\r\n    var formDraft = $('#addReportDraft');\r\n    var formData = new FormData();\r\n    var cstid = $('#customerID').val();\r\n\r\n    var x = formDraft.serializeArray();\r\n    $.each(x, function (i, field) {\r\n      formData.append(field.name, field.value);\r\n    });\r\n\r\n    formData.append(\"customer\", cstid);\r\n\r\n    $.ajax({\r\n      url: formDraft.attr(\"action\"),\r\n      type: formDraft.attr(\"method\"),\r\n      dataType: 'JSON',\r\n      data: formData,\r\n      processData: false,\r\n      contentType: false,\r\n      beforeSend: function () {\r\n        $('.btn-save').html(spinner);\r\n      },\r\n      success: function (response) {\r\n        $('.btn-save').html('Save');\r\n        if (response.auth) {\r\n          hulla.send(response.message, 'success');\r\n          populateDraftTable(1, rows);\r\n          $('#downlaodQrBtn').html('<a href=\"' + response.url + '\" class=\"btn btn-sm btn-danger mt-3\"><i class=\"fa fa-download fa-fw\"></i> Download</a>');\r\n          formData = null;\r\n          formDraft.trigger('reset');\r\n          return true;\r\n\r\n        } else {\r\n          hulla.send(response.message, 'danger');\r\n        }\r\n\r\n      },\r\n      error: function (jqXHR, textStatus, errorThrown) {\r\n        hulla.send(errorThrown, 'danger');\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n  // Function to Add a Report to DB\r\n  var updatePayment = function () {\r\n\r\n    var formPayment = $('#paymentForm');\r\n    var formData = new FormData();\r\n\r\n    var x = formPayment.serializeArray();\r\n    $.each(x, function (i, field) {\r\n      formData.append(field.name, field.value);\r\n    });\r\n\r\n    $.ajax({\r\n      url: formPayment.attr(\"action\"),\r\n      type: formPayment.attr(\"method\"),\r\n      dataType: 'JSON',\r\n      data: formData,\r\n      processData: false,\r\n      contentType: false,\r\n      beforeSend: function () {\r\n        $('#payBtnSave').html(spinner);\r\n      },\r\n      success: function (response) {\r\n        $('#payBtnSave').html('Save');\r\n        if (response.auth) {\r\n          hulla.send(response.message, 'success');\r\n          populateDraftTable(1, rows);\r\n          $('#receiptCount').text(response.total);\r\n          $('#paymentModal').modal('hide');\r\n\r\n          formData = null;\r\n          formPayment.trigger('reset');\r\n          return true;\r\n\r\n        } else {\r\n          hulla.send(response.message, 'danger');\r\n        }\r\n\r\n      },\r\n      error: function (jqXHR, textStatus, errorThrown) {\r\n        hulla.send(errorThrown, 'danger');\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n  //\r\n  var printReady = function () {\r\n    return $('#tableDraft input:checked').map(function() {\r\n      return this.value;\r\n    }).get().join('-');\r\n  };\r\n\r\n\r\n  /** Event Binding **/\r\n\r\n  populateCustomer();\r\n\r\n  populateShapeCut();\r\n\r\n  populateColor();\r\n\r\n  // Report type selection\r\n  reptype.click(function () {\r\n    if (this.id == 'option1') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    } else if (this.id == 'option2') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    } else if (this.id == 'option3') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    }\r\n  });\r\n\r\n  // Populating draft table function call\r\n  populateDraftTable(1, rows);\r\n\r\n  // Payment status Advance amount input field display\r\n  $('#pStatus').change(function () {\r\n    var selected = $(this).val();\r\n    if (selected == 'paid-advance') {\r\n      $('#adField').show();\r\n    } else {\r\n      $('#adField').hide();\r\n    }\r\n  });\r\n\r\n  $('#rowCount').on('change', function () {\r\n    populateDraftTable(1, this.value);\r\n  });\r\n\r\n  //\r\n  $(\"#searchId\").keyup(function (){\r\n    var key = $(this).val();\r\n    if (key.length >= 2) {\r\n      searchDraft(key);\r\n    }\r\n  });\r\n\r\n  $('#paymentModal').on('hidden.bs.modal', function (e) {\r\n    $('#paymentForm').trigger('reset');\r\n    $('#adField').hide();\r\n  })\r\n\r\n  var btnActions = {\r\n    pagination: function (e) {\r\n      e.preventDefault();\r\n      var page = $(this).data(\"ci-pagination-page\");\r\n      populateDraftTable(page, rows);\r\n    },\r\n    reload: function (e) {\r\n      e.preventDefault();\r\n      $('#rowCount').prop('selectedIndex', 0);\r\n      $(\"#searchId\").val('');\r\n      populateDraftTable(1, rows);\r\n    },\r\n    saveDraft: function (e) {\r\n      e.preventDefault();\r\n      addReport();\r\n    },\r\n    payment:function () {\r\n      $('#pRepId').val($(this).data('id'));\r\n      $('#pRepType').val($(this).data('type'));\r\n      //$(this).closest('tr').toggleClass(\"highlight\", this.checked);\r\n    },\r\n    saveAmount: function (e) {\r\n      e.preventDefault();\r\n      updatePayment();\r\n    }\r\n\r\n  };\r\n\r\n  $(document).on(\"click\", 'a[data-action]', function (event) {\r\n    var link = $(this);\r\n    var action = link.data(\"action\");\r\n\r\n    if (typeof btnActions[action] === \"function\") {\r\n      btnActions[action].call(this, event);\r\n    }\r\n  });\r\n\r\n  $(document).on('click', 'td:first-child input', function(){\r\n    var link = baseurl + 'admin/report/print/receipt/'+ printReady();\r\n    $(this).closest('tr').toggleClass(\"highlight\", this.checked);\r\n    $('#btnPrint').attr('href', link);\r\n  });\r\n\r\n  $(document).on('change', 'th:first-child input', function() {\r\n    var checkboxes = $(this).closest('table').find(':checkbox');\r\n    checkboxes.prop('checked', $(this).is(':checked'));\r\n    var link = baseurl + 'admin/report/print/receipt/'+ printReady();\r\n    $(this).closest('table').find('tr').toggleClass(\"highlight\", this.checked);\r\n    $('#btnPrint').attr('href', link);\r\n  });\r\n\r\n});"]}