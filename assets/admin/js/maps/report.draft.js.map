{"version":3,"sources":["report.draft.js"],"names":["$","rows","find","text","spinner","reptype","hulla","hullabaloo","populateDraftTable","page","ajax","url","baseurl","type","dataType","data","beforeSend","html","success","fail","jqXHR","textStatus","errorThrown","console","log","getId","reportType","repotype","val","autocomplete","source","request","response","q","term","results","map","value","key","label","firstname","lastname","id","custid","minLength","select","event","ui","item","shapecut","color","click","this","change","show","hide","on","keyup","length","search","e","trigger","btnActions","pagination","preventDefault","reload","prop","saveDraft","formDraft","formData","cstid","x","FormData","serializeArray","each","i","field","append","name","attr","processData","contentType","auth","send","message","error","payment","saveAmount","formPayment","total","modal","document","action","call"],"mappings":"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","file":"../report.draft.js","sourcesContent":["$(function () {\r\n\r\n  // Variables\r\n  var rows = $('#rowCount').find(\":selected\").text();\r\n  var spinner = '<i class=\"fa fa-spinner fa-pulse fa-lg fa-fw d-block mx-auto text-white\"></i><span class=\"sr-only\">Loading...</span>';\r\n  var reptype = $('#option1, #option2, #option3');\r\n  var hulla = new hullabaloo();\r\n\r\n  // Fetch all reports\r\n  var populateDraftTable = function (page, rows) {\r\n\r\n    $.ajax({\r\n      url: baseurl + 'admin/report/draft/handler/populate-draft/' + page + '/',\r\n      type: 'GET',\r\n      dataType: 'html',\r\n      data: {\r\n        page: page,\r\n        rows: rows\r\n      },\r\n      beforeSend: function () {\r\n        $('#draftTable').html(spinner);\r\n      },\r\n      success: function (data) {\r\n        $('#draftTable').html('');\r\n        $('#draftTable').html(data);\r\n      },\r\n      fail: function (jqXHR, textStatus, errorThrown) {\r\n        console.log(errorThrown);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Search Report\r\n\tvar searchDraft = function (key) {\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: baseurl + 'admin/report/draft/handler/populate-draft',\r\n\t\t\ttype: 'GET',\r\n\t\t\tdataType: 'html',\r\n\t\t\tdata: {\r\n\t\t\t\tsearch: true,\r\n\t\t\t\tid: key\r\n\t\t\t},\r\n\t\t\tbeforeSend: function () {\r\n\t\t\t\t$('#draftTable').html(spinner);\r\n\t\t\t},\r\n\t\t\tsuccess: function (data) {\r\n\t\t\t\t$('#draftTable').html('');\r\n        $('#draftTable').html(data);\r\n\t\t\t},\r\n\t\t\tfail: function (jqXHR, textStatus, errorThrown) {\r\n\t\t\t\tconsole.log(errorThrown);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n  // Fetch ID Based on user select\r\n  var getId = function (reportType) {\r\n    $.ajax({\r\n      url: baseurl + 'admin/report/handler/id',\r\n      type: 'GET',\r\n      dataType: 'html',\r\n      data: {\r\n        repotype: reportType\r\n      },\r\n      success: function (data) {\r\n        $('#repid').val(data);\r\n      },\r\n      fail: function () {\r\n        console.log('Error');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Function to populate customer on user input\r\n  var populateCustomer = function () {\r\n    $(\"#customer\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/customers/customer/append-customer',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.firstname + ' ' + value.lastname,\r\n              value: value.firstname + ' ' + value.lastname,\r\n              id: value.custid\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 1,\r\n      select: function (event, ui) {\r\n        $('#customerID').val(ui.item.id);\r\n      }\r\n    });\r\n  };\r\n\r\n  // Function to populate shape-cut field on user input\r\n  var populateShapeCut = function () {\r\n    $(\"#shapecutField\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/report/handler/populate-shapecut',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.shapecut,\r\n              value: value.shapecut\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 2\r\n    });\r\n  };\r\n\r\n  // Function to populate color field on user input\r\n  var populateColor = function () {\r\n    $(\"#colorField\").autocomplete({\r\n      source: function (request, response) {\r\n        $.ajax({\r\n          url: baseurl + 'admin/report/handler/populate-color',\r\n          dataType: \"json\",\r\n          data: {\r\n            q: request.term\r\n          }\r\n        }).success(function (data) {\r\n          var results = $.map(data, function (value, key) {\r\n            return {\r\n              label: value.color,\r\n              value: value.color\r\n            };\r\n          });\r\n          response(results);\r\n        });\r\n      },\r\n      minLength: 2\r\n    });\r\n  };\r\n\r\n  // Function to Add a Report to DB\r\n  var addReport = function () {\r\n\r\n    var formDraft = $('#addReportDraft');\r\n    var formData = new FormData();\r\n    var cstid = $('#customerID').val();\r\n\r\n    var x = formDraft.serializeArray();\r\n    $.each(x, function (i, field) {\r\n      formData.append(field.name, field.value);\r\n    });\r\n\r\n    formData.append(\"customer\", cstid);\r\n\r\n    $.ajax({\r\n      url: formDraft.attr(\"action\"),\r\n      type: formDraft.attr(\"method\"),\r\n      dataType: 'JSON',\r\n      data: formData,\r\n      processData: false,\r\n      contentType: false,\r\n      beforeSend: function () {\r\n        $('.btn-save').html(spinner);\r\n      },\r\n      success: function (response) {\r\n        $('.btn-save').html('Save');\r\n        if (response.auth) {\r\n          hulla.send(response.message, 'success');\r\n          populateDraftTable(1, rows);\r\n          $('#downlaodQrBtn').html('<a href=\"' + response.url + '\" class=\"btn btn-sm btn-danger mt-3\"><i class=\"fa fa-download fa-fw\"></i> Download</a>');\r\n          formData = null;\r\n          formDraft.trigger('reset');\r\n          return true;\r\n\r\n        } else {\r\n          hulla.send(response.message, 'danger');\r\n        }\r\n\r\n      },\r\n      error: function (jqXHR, textStatus, errorThrown) {\r\n        hulla.send(errorThrown, 'danger');\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n  // Function to Add a Report to DB\r\n  var updatePayment = function () {\r\n\r\n    var formPayment = $('#paymentForm');\r\n    var formData = new FormData();\r\n\r\n    var x = formPayment.serializeArray();\r\n    $.each(x, function (i, field) {\r\n      formData.append(field.name, field.value);\r\n    });\r\n\r\n    $.ajax({\r\n      url: formPayment.attr(\"action\"),\r\n      type: formPayment.attr(\"method\"),\r\n      dataType: 'JSON',\r\n      data: formData,\r\n      processData: false,\r\n      contentType: false,\r\n      beforeSend: function () {\r\n        $('#payBtnSave').html(spinner);\r\n      },\r\n      success: function (response) {\r\n        $('#payBtnSave').html('Save');\r\n        if (response.auth) {\r\n          hulla.send(response.message, 'success');\r\n          populateDraftTable(1, rows);\r\n          $('#receiptCount').text(response.total);\r\n          $('#paymentModal').modal('hide');\r\n\r\n          formData = null;\r\n          formPayment.trigger('reset');\r\n          return true;\r\n\r\n        } else {\r\n          hulla.send(response.message, 'danger');\r\n        }\r\n\r\n      },\r\n      error: function (jqXHR, textStatus, errorThrown) {\r\n        hulla.send(errorThrown, 'danger');\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n\r\n  /** Event Binding **/\r\n\r\n  populateCustomer();\r\n\r\n  populateShapeCut();\r\n\r\n  populateColor();\r\n\r\n  // Report type selection\r\n  reptype.click(function () {\r\n    if (this.id == 'option1') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    } else if (this.id == 'option2') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    } else if (this.id == 'option3') {\r\n      $('#repotype').val($(this).data('value'));\r\n      getId($(this).data('value'));\r\n    }\r\n  });\r\n\r\n  // Populating draft table function call\r\n  populateDraftTable(1, rows);\r\n\r\n  // Payment status Advance amount input field display\r\n  $('#pStatus').change(function () {\r\n    var selected = $(this).val();\r\n    if (selected == 'paid-advance') {\r\n      $('#adField').show();\r\n    } else {\r\n      $('#adField').hide();\r\n    }\r\n  });\r\n\r\n  $('#rowCount').on('change', function () {\r\n    populateDraftTable(1, this.value);\r\n  });\r\n\r\n  //\r\n  $(\"#searchId\").keyup(function (){\r\n    var key = $(this).val();\r\n    if (key.length >= 2) {\r\n      searchDraft(key);\r\n    }\r\n  });\r\n\r\n  $('#paymentModal').on('hidden.bs.modal', function (e) {\r\n    $('#paymentForm').trigger('reset');\r\n    $('#adField').hide();\r\n  })\r\n\r\n  var btnActions = {\r\n    pagination: function (e) {\r\n      e.preventDefault();\r\n      var page = $(this).data(\"ci-pagination-page\");\r\n      populateDraftTable(page, rows);\r\n    },\r\n    reload: function (e) {\r\n      e.preventDefault();\r\n      $('#rowCount').prop('selectedIndex', 0);\r\n      $(\"#searchId\").val('');\r\n      populateDraftTable(1, rows);\r\n    },\r\n    saveDraft: function (e) {\r\n      e.preventDefault();\r\n      addReport();\r\n    },\r\n    payment:function () {\r\n      $('#pRepId').val($(this).data('id'));\r\n      $('#pRepType').val($(this).data('type'));\r\n    },\r\n    saveAmount: function (e) {\r\n      e.preventDefault();\r\n      updatePayment();\r\n    }\r\n\r\n  };\r\n\r\n  $(document).on(\"click\", 'a[data-action]', function (event) {\r\n    var link = $(this);\r\n    var action = link.data(\"action\");\r\n\r\n    if (typeof btnActions[action] === \"function\") {\r\n      btnActions[action].call(this, event);\r\n    }\r\n  });\r\n});"]}